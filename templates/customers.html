{% extends 'base.html' %}

{% block content %}
<div class="page-header"
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2 style="font-size: 1.5rem; font-weight: 600; color: var(--text-primary);">{{ t('customers') }}</h2>
    <div style="display: flex; gap: 1rem; align-items: center;">
        <div class="month-nav"
            style="display: flex; align-items: center; background: var(--card-bg); padding: 0.25rem; border-radius: 0.375rem; border: 1px solid var(--border-color);">
            <a href="{{ month_nav.prev_url }}" class="btn btn-sm btn-ghost" title="Previous Month"
                style="color: var(--text-secondary);">
                <i class="fa-solid fa-chevron-left"></i>
            </a>
            <span
                style="padding: 0 1rem; font-weight: 600; color: var(--text-primary); min-width: 140px; text-align: center;">
                {{ month_nav.current }}
            </span>
            <a href="{{ month_nav.next_url }}" class="btn btn-sm btn-ghost" title="Next Month"
                style="color: var(--text-secondary);">
                <i class="fa-solid fa-chevron-right"></i>
            </a>
        </div>
        <button class="btn btn-primary" onclick="toggleModal('addCustomerModal')">
            <i class="fa-solid fa-plus"></i> {{ t('add_new_customer') }}
        </button>
    </div>
</div>

<!-- Filters -->
<div class="card" style="margin-bottom: 1.5rem;">
    <form action="{{ url_for('customers') }}" method="GET" class="filter-bar"
        style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">

        <!-- Search -->
        <div style="flex: 1; min-width: 200px; position: relative;">
            <i class="fa-solid fa-magnifying-glass"
                style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
            <input type="text" name="q" value="{{ request.args.get('q', '') }}"
                placeholder="{{ t('search_name_mobile') }}"
                style="width: 100%; padding: 0.75rem 0.75rem 0.75rem 2.5rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);">
        </div>

        <!-- Gender Filter -->
        <select name="gender" onchange="this.form.submit()"
            style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary); cursor: pointer;">
            <option value="">{{ t('all_genders') }}</option>
            <option value="male" {% if request.args.get('gender')=='male' %}selected{% endif %}>{{ t('male') }}</option>
            <option value="female" {% if request.args.get('gender')=='female' %}selected{% endif %}>{{ t('female') }}
            </option>
        </select>

        <!-- Balance/Status Filter -->
        <select name="status" onchange="this.form.submit()"
            style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary); cursor: pointer;">
            <option value="">{{ t('balance_all') }}</option>
            <option value="pending" {% if request.args.get('status')=='pending' %}selected{% endif %}>{{
                t('pending_balance') }}
            </option>
            <option value="paid" {% if request.args.get('status')=='paid' %}selected{% endif %}>{{ t('all_paid') }}
            </option>
        </select>

        <!-- Date Filter (Last Visit) -->
        <input type="date" name="date" value="{{ request.args.get('date', '') }}" onchange="this.form.submit()"
            style="padding: 0.65rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary); cursor: pointer;"
            title="Filter by Visit Date">

        <!-- Reset Button -->
        {% if request.args.get('q') or request.args.get('gender') or request.args.get('status') or
        request.args.get('date') %}
        <a href="{{ url_for('customers') }}" class="btn btn-outline"
            style="border: 1px solid var(--border-color); padding: 0.75rem;">
            <i class="fa-solid fa-xmark"></i>
        </a>
        {% endif %}
    </form>
</div>

<!-- Customers Table -->
<div class="card">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="width: 50px;">{{ t('id') }}</th>
                    <th style="width: 60px;">{{ t('photo') }}</th>
                    <th>{{ t('name') }} / {{ t('mobile') }}</th>
                    <th>{{ t('gender') }}</th>
                    <th>{{ t('last_visit') }}</th>
                    <th>{{ t('total_orders') }}</th>
                    <th>{{ t('actions') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr>
                    <td>{{ (pagination.page - 1) * pagination.per_page + loop.index }}</td>
                    <td>
                        <div
                            class="avatar avatar-base {% if customer.gender == 'female' %}avatar-female{% else %}avatar-male{% endif %}">
                            {% if customer.photo %}
                            <img src="{{ url_for('static', filename=customer.photo) }}" alt="{{ customer.name }}"
                                style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                            {% else %}
                            {% if customer.gender == 'female' %}
                            <i class="fa-solid fa-person-dress"></i>
                            {% else %}
                            <i class="fa-solid fa-person"></i>
                            {% endif %}
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: 600; color: var(--text-primary);">{{ customer.name }}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">{{ customer.mobile }}</div>
                    </td>
                    <td>
                        {% if customer.gender == 'male' %}<span style="color: #2563eb; font-weight: 500;"><i
                                class="fa-solid fa-mars"></i> {{ t('male') }}</span>{% endif %}
                        {% if customer.gender == 'female' %}<span style="color: #db2777; font-weight: 500;"><i
                                class="fa-solid fa-venus"></i> {{ t('female') }}</span>{% endif %}
                        {% if not customer.gender %}<span style="color: var(--text-secondary);">-</span>{% endif %}
                    </td>
                    <td>
                        <div>{{ customer.last_visit.strftime('%d-%b-%Y') }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">{{
                            customer.last_visit.strftime('%I:%M %p') }}</div>
                    </td>
                    <td>
                        <!-- Improve: Show last order item or count -->
                        <div>{{ customer.order_count_opt }} {{ t('orders') }}</div>
                        {% if customer.total_pending_opt > 0 %}
                        <div style="font-size: 0.85rem; color: var(--danger-color); font-weight: 500;">
                            ₹{{ "{:,.0f}".format(customer.total_pending_opt) }} pending
                        </div>
                        {% else %}
                        <div style="font-size: 0.85rem; color: var(--success-color); font-weight: 500;">
                            {{ t('all_paid') }}
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="openProfile('{{ customer.id }}')" class="btn btn-sm btn-primary"
                                title="Profile">
                                <i class="fa-solid fa-ruler-combined"></i>
                            </button>
                            <form action="{{ url_for('delete_customer', id=customer.id) }}" method="POST"
                                style="display:inline;"
                                onsubmit="return confirm('Are you sure you want to delete this customer? This will delete their orders and cannot be undone.');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                <button type="submit" class="btn btn-sm btn-outline"
                                    style="border: 1px solid var(--danger-color); color: var(--danger-color); display: inline-flex; align-items: center; justify-content: center;"
                                    title="Delete Customer">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 2rem;">{{ t('no_data_yet') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Pagination Mock -->
    <!-- Pagination -->
    <!-- Keyset Pagination -->
    <!-- Standard Pagination with Jump to Page -->
    <div
        style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--border-color);">
        <div style="font-size: 0.875rem; color: var(--text-secondary); display: flex; align-items: center; gap: 1rem;">
            <span>{{ t('showing_page') }} {{ pagination.page }} of {{ pagination.pages }}</span>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 0.8rem;">{{ t('go_to') }}:</span>
                <input type="number" min="1" max="{{ pagination.pages }}" value="{{ pagination.page }}"
                    class="form-input"
                    style="width: 70px; padding: 0.25rem 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;"
                    onchange="changePage(this.value)" </div>
            </div>

            <div style="display: flex; gap: 0.5rem;">
                <!-- Prev Button -->
                {% if pagination.has_prev %}
                <a href="{{ url_for('customers', page=pagination.prev_num, q=request.args.get('q'), gender=request.args.get('gender'), status=request.args.get('status'), date=request.args.get('date'), month=request.args.get('month'), year=request.args.get('year')) }}"
                    class="btn btn-sm btn-outline"
                    style="border: 1px solid var(--border-color); text-decoration: none;">
                    <i class="fa-solid fa-chevron-left"></i> {{ t('prev') }}
                </a>
                {% else %}
                <button class="btn btn-sm btn-outline" disabled
                    style="border: 1px solid var(--border-color); opacity: 0.5; cursor: not-allowed;">
                    <i class="fa-solid fa-chevron-left"></i> {{ t('prev') }}
                </button>
                {% endif %}

                <!-- Next Button -->
                {% if pagination.has_next %}
                <a href="{{ url_for('customers', page=pagination.next_num, q=request.args.get('q'), gender=request.args.get('gender'), status=request.args.get('status'), date=request.args.get('date'), month=request.args.get('month'), year=request.args.get('year')) }}"
                    class="btn btn-sm btn-outline"
                    style="border: 1px solid var(--border-color); text-decoration: none;">
                    {{ t('next') }} <i class="fa-solid fa-chevron-right"></i>
                </a>
                {% else %}
                <button class="btn btn-sm btn-outline" disabled
                    style="border: 1px solid var(--border-color); opacity: 0.5; cursor: not-allowed;">
                    {{ t('next') }} <i class="fa-solid fa-chevron-right"></i>
                </button>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Customer Profile Sidebar -->
    <div id="profileSidebar" class="sidebar-overlay" onclick="toggleModal('profileSidebar')">
        <div class="sidebar-panel" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div
                style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                <div>
                    <h3 id="profileName" style="font-size: 1.5rem; font-weight: 600;">Loading...</h3>
                    <p id="profileMobile" style="color: var(--text-secondary);">...</p>
                </div>
                <button onclick="toggleModal('profileSidebar')"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                <div class="card"
                    style="padding: 1rem; background: var(--bg-color); border: 1px solid var(--border-color);">
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">{{ t('pending_balance') }}</div>
                    <div id="profilePending" style="font-size: 1.2rem; font-weight: 700; color: var(--danger-color);">₹0
                    </div>
                </div>
                <div class="card"
                    style="padding: 1rem; background: var(--bg-color); border: 1px solid var(--border-color);">
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">{{ t('total_orders') }}</div>
                    <div id="profileOrdersCount"
                        style="font-size: 1.2rem; font-weight: 700; color: var(--primary-color);">0
                    </div>
                </div>
            </div>

            <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">{{ t('measurements_history') }}</h4>
            <div id="measurementsList" style="display: flex; flex-direction: column; gap: 1rem;">
                <!-- Rendered via JS -->
                <p style="color: var(--text-secondary);">Loading measurements...</p>
            </div>

            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <a id="profileNewMeasBtn" href="#" class="btn btn-primary"
                    style="width: 100%; justify-content: center;">
                    <i class="fa-solid fa-plus"></i> {{ t('new_measurement') }}
                </a>
            </div>
        </div>
    </div>

    <!-- Add Customer Sidebar (Slide Over) -->
    <div id="addCustomerModal" class="sidebar-overlay" onclick="toggleModal('addCustomerModal')">
        <div class="sidebar-panel" onclick="event.stopPropagation()">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                <h3 id="customerModalTitle" style="font-size: 1.5rem; font-weight: 600;">{{ t('add_new_customer') }}
                </h3>
                <button onclick="toggleModal('addCustomerModal')"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">&times;</button>
            </div>

            <form method="POST" action="{{ url_for('customers') }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <input type="hidden" name="customer_id" id="custIdInput">

                <!-- Profile Image Upload -->
                <div style="margin-bottom: 1.5rem; text-align: center;">
                    <label for="profile_image" style="cursor: pointer; display: inline-block; position: relative;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--bg-color); border: 2px dashed var(--border-color); display: flex; align-items: center; justify-content: center; overflow: hidden;"
                            id="imagePreview">
                            <i class="fa-solid fa-camera" style="font-size: 1.5rem; color: var(--text-secondary);"></i>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--primary-color);">{{
                            t('add_photo') if t else 'Add Photo' }}</div>
                    </label>
                    <input type="file" name="photo" id="profile_image" accept="image/*" style="display: none;"
                        onchange="previewImage(this)">
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{{ t('full_name') }}</label>
                    <input type="text" name="name" class="form-input" placeholder="{{ t('name_placeholder') }}" required
                        pattern="[A-Za-z\s]+" title="Only alphabets and spaces are allowed"
                        oninput="this.value = this.value.replace(/[^A-Za-z\s]/g, '')"
                        style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);">
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{{ t('mobile_number')
                        }}</label>
                    <input type="tel" name="mobile" class="form-input" placeholder="9876543210" required
                        pattern="\d{10}" title="Mobile number must be exactly 10 digits" maxlength="10"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)"
                        style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{{ t('city') }}</label>
                        <input type="text" name="city" class="form-input" placeholder="{{ t('city') }}"
                            style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{{ t('area') }}</label>
                        <input type="text" name="area" class="form-input" placeholder="{{ t('area') }}"
                            style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);">
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{{ t('gender') }}</label>
                    <select name="gender" class="form-input" required
                        style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);">
                        <option value="male">{{ t('male') }}</option>
                        <option value="female">{{ t('female') }}</option>
                    </select>
                </div>



                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">{{ t('note_reference')
                        }}</label>
                    <textarea name="notes" rows="2" class="form-input"
                        style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.375rem; background: var(--bg-color); color: var(--text-primary);"></textarea>
                </div>

                <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                    <button type="button" class="btn btn-outline" onclick="toggleModal('addCustomerModal')"
                        style="border: 1px solid var(--border-color);">{{ t('cancel') }}</button>
                    <button type="submit" class="btn btn-primary">{{ t('save_customer') }}</button>
                </div>
            </form>

            <script>
                function previewImage(input) {
                    if (input.files && input.files[0]) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            var preview = document.getElementById('imagePreview');
                            preview.style.backgroundImage = 'url(' + e.target.result + ')';
                            preview.style.backgroundSize = 'cover';
                            preview.style.backgroundPosition = 'center';
                            preview.innerHTML = ''; // Remove icon
                        }
                        reader.readAsDataURL(input.files[0]);
                    }
                }
            </script>
        </div>
    </div>

</div>

<!-- Profile Sidebar Modal -->
<div id="profileSidebar" class="sidebar-overlay" onclick="toggleModal('profileSidebar')">
    <div class="sidebar-panel" onclick="event.stopPropagation()">
        <!-- Header -->
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="position: relative;">
                    <div id="profileAvatarContainer"
                        style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; background: var(--bg-color); border: 2px solid var(--border-color);">
                        <img id="profileImage" src="" alt="Profile"
                            style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <div id="profilePlaceholder"
                            style="width: 100%; height: 100%; background: var(--secondary-color); display: flex; align-items: center; justify-content: center; color: white;">
                            <i id="profileGenderIcon" class="fa-solid fa-user" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <button onclick="editCurrentCustomer()"
                        style="position: absolute; bottom: 0; right: 0; background: var(--primary-color); color: white; border: 2px solid white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <i class="fa-solid fa-camera" style="font-size: 0.75rem;"></i>
                    </button>
                </div>
                <div>
                    <h3 id="profileName"
                        style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem;">
                        Loading...</h3>
                    <div id="profileMobile" style="color: var(--text-secondary); font-size: 0.95rem;">-</div>
                </div>
            </div>
            <button onclick="toggleModal('profileSidebar')"
                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">&times;</button>
        </div>

        <!-- Edit/Delete Actions -->
        <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
            <button type="button" onclick="editCurrentCustomer()" class="btn btn-outline"
                style="flex: 1; justify-content: center;">
                <i class="fa-solid fa-pen"></i> {{ t('edit') }}
            </button>
            <button type="button" onclick="deleteCurrentCustomer()" class="btn btn-outline"
                style="flex: 1; justify-content: center; border-color: var(--danger-color); color: var(--danger-color);">
                <i class="fa-solid fa-trash"></i> {{ t('delete') }}
            </button>
        </div>

        <!-- KPI Cards -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
            <div
                style="background: var(--bg-color); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">{{
                    t('pending_balance') }}
                </div>
                <div id="profilePending" style="font-size: 1.25rem; font-weight: 700; color: var(--danger-color);">₹0
                </div>
            </div>
            <div
                style="background: var(--bg-color); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">{{
                    t('total_orders') }}</div>
                <div id="profileOrdersCount" style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">
                    0</div>
            </div>
        </div>

        <!-- Action Button -->
        <a id="profileNewMeasBtn" href="#" class="btn btn-primary"
            style="display: flex; justify-content: center; align-items: center; width: 100%; padding: 1rem; margin-bottom: 2rem; font-weight: 600; text-decoration: none;">
            <i class="fa-solid fa-plus" style="margin-right: 0.5rem;"></i> {{ t('new_measurement') }}
        </a>

        <!-- Measurements List -->
        <div>
            <h4
                style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
                <i class="fa-solid fa-clock-rotate-left"
                    style="margin-right: 0.5rem; color: var(--text-secondary);"></i> {{ t('history') }}
            </h4>
            <div id="measurementsList">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>
</div>

<style>
    /* Sidebar Overlay */
    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: flex-end;
        /* Align to right */
    }

    /* Sidebar Panel */
    .sidebar-panel {
        width: 100%;
        max-width: 450px;
        height: 100%;
        background: var(--card-bg);
        padding: 2rem;
        box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
        transform: translateX(100%);
        /* Start hidden off-screen */
        transition: transform 0.3s ease-out;
        overflow-y: auto;
    }

    /* Active State for Panel */
    .sidebar-overlay.active .sidebar-panel {
        transform: translateX(0);
    }

    /* Avatar Colors to fix IDE linting false positives */
    .avatar-male {
        background-color: var(--primary-color);
    }

    .avatar-female {
        background-color: #ec4899;
        /* Pink as requested */
    }

    /* Mobile Improvements */
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: flex-start !important;
            /* Override inline style */
            gap: 1rem;
        }

        .filter-bar {
            flex-direction: column;
            align-items: stretch !important;
        }

        .filter-bar div[style*="min-width: 200px"] {
            min-width: auto !important;
            width: 100%;
        }

        /* Pagination Stack */
        div[style*="justify-content: space-between; align-items: center; padding-top: 1rem"] {
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start !important;
        }

        /* --- Mobile Table Card View --- */
        /* Force table to display as list of cards */
        table,
        thead,
        tbody,
        th,
        td,
        tr {
            display: block;
        }

        /* Hide table headers (but keep for screen readers if needed) */
        thead tr {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        tr {
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background: var(--card-bg);
            padding: 1rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        td {
            border: none;
            border-bottom: 1px solid #f3f4f6;
            position: relative;
            padding: 0.5rem 0;
            padding-left: 0;
            /* Override default padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        td:last-child {
            border-bottom: none;
        }

        /* Add labels using data-label if needed, or simply let content stack */
        /* For this specific layout, we want to look like the screenshot */

        /* Flex row for Photo + Name to simulate the card header look */
        /* We can't easily restructure HTML, so we style the cells */

        td:nth-of-type(1) {
            /* ID */
            display: none;
            /* Hide ID on mobile if not needed, or keep small */
        }

        /* Specific Cell adjustments */
        td:nth-of-type(2) {
            /* Photo */
            justify-content: center;
            padding-bottom: 0.5rem;
            border-bottom: none;
        }

        td:nth-of-type(3) {
            /* Name / Mobile */
            text-align: center;
            display: block;
            /* Stack name key */
            padding-top: 0;
        }

        td:nth-of-type(3)>div {
            /* Center text */
            text-align: center;
        }
    }
</style>

<script>
    function changePage(page) {
        const params = new URLSearchParams(window.location.search);
        params.set('page', page);
        window.location.href = "{{ url_for('customers') }}?" + params.toString();
    }
</script>

{% endblock %}